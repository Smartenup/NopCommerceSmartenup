"use strict";function orderSummaryContext(n,t,i,r,u,f,e){function l(i){n.$broadcast("orderSummaryContextChanging",{updateCartItem:i});r.updateCartItem(i).then(function(t){var r=t.data,e;r&&r.length>0?(e=$.grep(o.items,function(n){return n.id==i.id}),e.length>0&&(e[0].warnings=r,n.$broadcast("orderSummaryContextChanged",{errorOccured:!0}))):(u.changeNumberOfItemsWhenCartItemsQuantityIsUpdated(),n.$broadcast("orderSummaryContextChanged",{updateCartItem:i}));f.broadcastNativeAddOrRemoveFromCartEvent(i.productId,t.config.data.cartItemQuantity,s.getLastState());s.setState(o)},function(i){return o=s.getLastState(),n.$broadcast("orderSummaryContextChanged"),t.reject(i)})}function a(i){n.$broadcast("orderSummaryContextChanging",{removeCartItem:i});r.removeCartItem(i).then(function(t){t.data.cartItemsCount===0?n.$broadcast("noCartItems"):(s.setState(o),n.$broadcast("orderSummaryContextChanged",{removeCartItem:i}),u.changeNumberOfItemsWhenEntireItemIsRemoved(i.quantity),f.broadcastNativeRemoveFromCartEvent(i.productId,i.quantity))},function(i){return o=s.getLastState(),n.$broadcast("orderSummaryContextChanged"),t.reject(i)})}function h(i){return n.$broadcast("orderSummaryContextChanging",{initialLoad:i}),r.getShoppingCartItems().then(function(t){var r,u;for(o=t.data,r=0;r<o.items.length;r++)o.items[r].allowedQuantities.length>0&&(u=o.items[r].quantity.toString(),o.items[r].quantity={text:u,value:u});s.setState(o);n.$broadcast("orderSummaryContextChanged",{initialLoad:i})},function(i){return o=s.getLastState(),n.$broadcast("orderSummaryContextChanged"),t.reject(i)})}function v(){return o}function y(n){var r=$.grep(n,function(n){return n.deleted}),t,i;r.length>0&&a(r[0]);t=$.grep(n,function(n){return n.updated});t.length>0&&(i=$.grep(o.items,function(n){return n.id==t[0].id}),i[0]&&t[0].quantity!=i[0].quantity&&l(t[0]))}var c={load:h,get:v,set:y},o,s=e.instance();return n.$on("resetOrderSummaryData",function(){o=undefined;h()}),c}angular.module("realOnePageCheckout.orderSummary").factory("orderSummaryContext",orderSummaryContext);orderSummaryContext.$inject=["$rootScope","$q","api","orderSummaryService","objectUtility","nativeEventsUtility","stateHolder"];